var __extends=this.__extends||function(n,t){function i(){this.constructor=n}i.prototype=t.prototype,n.prototype=new i},FileUpload;(function(n){var t=function(t){function i(){t.apply(this,arguments)}return __extends(i,t),i.timerId=0,i.rg1=/^[^\\:\*\?"<>\|\%]+$/,i.rg2=/^\./,i.rg3=/^(nul|prn|con|lpt[0-9]|com[0-9])(\.|$)/i,i.uploadResult=!1,i.phaseValue=1,i.prototype.isValidFileName=function(n){return i.rg1.test(n)&&!i.rg2.test(n)&&!i.rg3.test(n)},i.prototype.canUploadFile=function(){var n;try{return n=new FormData,n!==undefined}catch(t){return n}},i.prototype.uploadFile=function(t){var u=$("#uploadFile").val(),r;if(i.prototype.canUploadFile()===undefined)alert("Your current version of the browser is not supporting file upload functionality");else{if(i.prototype.validateFileExtension(u,t==1?!0:!1)===!1)return alert("Please use the images for file upload"),$("#uploadFile").focus(),$("#uploadFile").val(""),!1;r=$("#uploadFile")[0].files[0],r.size<=4194304?(t!==3?$("#imageProcess").css("display","inline-block"):n.FileUploadFile.phaseValue===1?$("#imageProcessph1").css("display","inline-block"):$("#imageProcessph2").css("display","inline-block"),i.prototype.getFilToken(t)):(alert("maximum file size of 4MB exceeded"),$("#uploadFile").focus(),$("#uploadFile").val(""))}},i.prototype.uploadFileWithToken=function(i,r){var o=$("#uploadFile")[0].files[0],u=new FormData,f,e;u!==undefined&&(u.append("file",o),u.append("token",i),u.append("competitionId",parseInt($("#CompetitionId").val())),r===3&&u.append("phaseNumber",n.FileUploadFile.phaseValue),f=function(){n.FileUploadFile.timerId=setInterval("FileUpload.FileUploadFile.prototype.getFilStatus("+i+","+r+")",3e3)},e=function(){clearInterval(n.FileUploadFile.timerId),$("#imageProcess").hide(),$(".preloaderInputImg").hide()},t.prototype.ajaxFileUploadRequest.call(this,"/FileUpload/Submit/",f,e,u))},i.prototype.getFilToken=function(t){var r={reason:t};$.ajax({url:"/FileUpload/Begin",type:"post",cache:!1,data:r,success:function(n){i.prototype.uploadFileWithToken(n,t)},error:function(){clearInterval(n.FileUploadFile.timerId),$("#imageProcess").hide(),$(".preloaderInputImg").hide()}})},i.prototype.getFilStatus=function(t,i){$("#resultStatus").hide();var r={id:t};$.ajax({url:"/FileUpload/Status",type:"post",cache:!1,data:r,success:function(r){if(n.FileUploadFile.timerId<1e4)if(r.status==8){if(i===1)$("#imgProfileImage")[0].src="/file/download/"+t;else if(i===3){n.FileUploadFile.phaseValue===1?($("#errorLabelPh1").text(""),$("#errorLabelPh1").css("display","inline-block"),$("#errorLabelPh1").text(r.message),$("#ph1datasetimg div").removeClass().addClass("expCollDatasetExp"),$("#ph1datasetimg").parents("section").siblings(".downloadedContainer").hide()):($("#errorLabelPh2").text(""),$("#errorLabelPh2").css("display","inline-block"),$("#errorLabelPh2").text(r.message),$("#ph2datasetimg div").removeClass().addClass("expCollDatasetExp"),$("#ph2datasetimg").parents("section").siblings(".downloadedContainer").hide());var u=new Competition.CreateCompetition;u.ajaxRequestForManagingPublishTab()}else Competition.CompetitionDetails.prototype.requestPartialViewcontroller(10),n.FileUploadFile.uploadResult=!0;$("#imageProcess").css("display","none"),clearInterval(n.FileUploadFile.timerId),$(".preloaderInputImg").hide()}else r.status==9&&($("#resultStatus").show(),$("#resultStatus").text(r.message),$("#imageProcess").css("display","none"),$(".preloaderInputImg").hide(),i===3&&(n.FileUploadFile.phaseValue===1?($("#errorLabelPh1").css("display","inline-block"),$("#errorLabelPh1").text(""),$("#errorLabelPh1").text(r.message)):($("#errorLabelPh2").text(""),$("#errorLabelPh2").css("display","inline-block"),$("#errorLabelPh2").text(r.message))),clearInterval(n.FileUploadFile.timerId));else $("#imageProcess").css("display","none"),$(".preloaderInputImg").hide(),clearInterval(n.FileUploadFile.timerId)},error:function(t,i,r){clearInterval(n.FileUploadFile.timerId),$("#imageProcess").hide(),$(".preloaderInputImg").hide(),$("#resultStatus").text(r)}})},i.prototype.validateFileExtension=function(n,t){if(t===!0){var i=n.split(".").pop().toLowerCase();return $.inArray(i,["gif","png","jpg","jpeg","bmp"])!=-1}return!0},i}(Ajax.AjaxRequest);n.FileUploadFile=t})(FileUpload||(FileUpload={}))